<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Terraform V3 - Full Stack</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Un fondo suave para que no sea blanco plano */
        body {
            background: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            border-radius: 15px; /* Bordes un poco m谩s redondeados */
        }
        /* Clase para animaci贸n suave al aparecer la info del backend */
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-success text-white text-center py-3" style="border-radius: 15px 15px 0 0;">
                        <h5 class="mb-0 text-uppercase spacing">Estado del Sistema</h5>
                    </div>
                    
                    <div class="card-body text-center p-5">
                        <span class="badge bg-success bg-opacity-10 text-success mb-3 border border-success">
                            Actualizaci贸n Full Stack
                        </span>
                        
                        <h1 class="display-4 fw-bold text-dark">Versi贸n 2.5</h1>
                        <p class="lead text-secondary">Frontend + Backend Python integrados.</p>
                        
                        <hr class="my-4">
                        
                        <div id="loading-spinner" class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>

                        <div id="backend-response" class="alert alert-info text-start d-none fade-in" role="alert">
                            <h5 class="alert-heading text-center"> Datos del Backend</h5>
                            <hr>
                            <p class="mb-1"><strong>Mensaje:</strong> <span id="api-message">...</span></p>
                            <p class="mb-1"><strong>Sistema:</strong> <span id="api-system">...</span></p>
                            <p class="mb-0"><strong>Fecha Servidor:</strong> <span id="api-time">...</span></p>
                        </div>
                        <p class="text-muted mt-4 mb-4">
                            Si ves el cuadro azul arriba, significa que el contenedor Docker est谩 sirviendo el HTML y ejecutando Python simult谩neamente.
                        </p>
                        
                        <div class="d-grid gap-2 col-8 mx-auto">
                            <button class="btn btn-outline-success btn-lg" onclick="location.reload()">Recargar Prueba</button>
                        </div>
                    </div>
                    
                    <div class="card-footer text-muted text-center py-3 bg-light" style="border-radius: 0 0 15px 15px;">
                        Terraform + GitHub Actions + Flask
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Hacemos la petici贸n al endpoint que definimos en app.py
            fetch('/api/info')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la respuesta de la red');
                    }
                    return response.json();
                })
                .then(data => {
                    // Ocultar spinner
                    document.getElementById('loading-spinner').classList.add('d-none');
                    
                    // Mostrar caja de datos
                    const responseBox = document.getElementById('backend-response');
                    responseBox.classList.remove('d-none');
                    
                    // Inyectar los datos recibidos del JSON
                    document.getElementById('api-message').innerText = data.mensaje;
                    document.getElementById('api-system').innerText = data.sistema + " (" + data.nodo + ")";
                    document.getElementById('api-time').innerText = data.fecha;
                })
                .catch(error => {
                    console.error('Hubo un problema con la petici贸n Fetch:', error);
                    document.getElementById('loading-spinner').classList.add('d-none');
                    alert("No se pudo conectar con el Backend. Revisa que app.py est茅 corriendo.");
                });
        });
    </script>
</body>
</html>